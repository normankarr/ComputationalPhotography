<!DOCTYPE html>
<html style="font-size: 16px;">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>Final Project</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
<link rel="stylesheet" href="Final-Project.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 3.24.3, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">









    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "Site1"
}</script>
    <meta name="theme-color" content="#ec8700">
    <meta property="og:title" content="Final Project">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
  </head>
  <body class="u-body"><header class="u-clearfix u-header u-header" id="sec-87a3"><div class="u-clearfix u-sheet u-sheet-1">
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1" data-responsive-from="XL">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px; font-weight: 700; text-transform: uppercase;">
            <a class="u-button-style u-custom-active-border-color u-custom-border u-custom-border-color u-custom-borders u-custom-hover-border-color u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-color u-custom-text-hover-color u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use></svg>
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="menu-hamburger" viewBox="0 0 16 16" style="width: 16px; height: 16px;"><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</symbol>
</defs></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container" wfd-invisible="true">
            <ul class="u-nav u-spacing-30 u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="https://normankarr.com/computational-photography/prokudin-gorskii/" style="padding: 10px 0px;">Prokudin-Gorskii</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="https://normankarr.com/computational-photography/filters-and-frequencies/" style="padding: 10px 0px;">Filters and Frequencies</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="https://normankarr.com/computational-photography/face-morphing/" style="padding: 10px 0px;">Face Morphing</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="https://normankarr.com/computational-photography/mosaics/" style="padding: 10px 0px;">Mosaics</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="normankarr.com/computational-photography/keypoint-detection" style="padding: 10px 0px;">Keypoint Detection</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="https://normankarr.com/computational-photography/final-projects/" style="padding: 10px 0px;">Final Project</a>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="https://normankarr.com/computational-photography/prokudin-gorskii/" style="padding: 10px 0px;">Prokudin-Gorskii</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="https://normankarr.com/computational-photography/filters-and-frequencies/" style="padding: 10px 0px;">Filters and Frequencies</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="https://normankarr.com/computational-photography/face-morphing/" style="padding: 10px 0px;">Face Morphing</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="https://normankarr.com/computational-photography/mosaics/" style="padding: 10px 0px;">Mosaics</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="normankarr.com/computational-photography/keypoint-detection" style="padding: 10px 0px;">Keypoint Detection</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="https://normankarr.com/computational-photography/final-projects/" style="padding: 10px 0px;">Final Project</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70" wfd-invisible="true"></div>
          </div>
        </nav>
        <a href="https://normankarr.com/computational-photography/prokudin-gorskii/" class="u-active-none u-border-2 u-border-grey-80 u-btn u-btn-rectangle u-button-style u-hover-none u-none u-radius-0 u-btn-1">Prokudin Gorskii</a>
        <a href="https://normankarr.com/computational-photography/filters-and-frequencies/" class="u-active-none u-border-2 u-border-grey-80 u-btn u-btn-rectangle u-button-style u-hover-none u-none u-radius-0 u-btn-2">Filters and Frequencies</a>
        <a href="https://normankarr.com/computational-photography/face-morphing/" class="u-active-none u-border-2 u-border-grey-80 u-btn u-btn-rectangle u-button-style u-hover-none u-none u-radius-0 u-btn-3">Face Morphing</a>
        <a href="https://normankarr.com/computational-photography/mosaics/" class="u-active-none u-border-2 u-border-grey-80 u-btn u-btn-rectangle u-button-style u-hover-none u-none u-radius-0 u-btn-4">Mosaics</a>
        <a href="https://normankarr.com/computational-photography/keypoint-detection/" class="u-active-none u-border-2 u-border-grey-80 u-btn u-btn-rectangle u-button-style u-hover-none u-none u-radius-0 u-btn-5">Keypoint Detection</a>
        <a href="https://normankarr.com/computational-photography/final-project/" class="u-active-none u-border-2 u-border-grey-80 u-btn u-btn-rectangle u-button-style u-hover-none u-none u-radius-0 u-btn-6">Final Project</a>
      </div></header>
    <section class="u-align-center u-clearfix u-image u-section-1" id="sec-e19d" data-image-width="2236" data-image-height="806">
      <div class="u-clearfix u-sheet u-sheet-1">
        <div class="u-container-style u-group u-opacity u-opacity-90 u-shape-rectangle u-white u-group-1">
          <div class="u-container-layout u-container-layout-1">
            <h5 class="u-text u-text-default u-text-1">CS194-26: Final Project</h5>
            <h2 class="u-align-center u-subtitle u-text u-text-2">Semantic Segmentation to Spade Pipeline</h2>
            <h5 class="u-text u-text-3">Norman Karr | nkarr11@berkeley.edu</h5>
          </div>
        </div>
      </div>
    </section>
    <section class="u-align-center u-clearfix u-section-2" id="sec-1e87">
      <div class="u-container-style u-expanded-width u-grey-80 u-group u-shape-rectangle u-group-1">
        <div class="u-container-layout u-container-layout-1">
          <h1 class="u-text u-text-default u-text-1">Section 1: Introduction</h1>
        </div>
      </div>
      <h2 class="u-text u-text-default u-text-2">Main Idea</h2>
      <p class="u-text u-text-3">The primary goal of this final project was to be an exploratory endeavor into two of computer vision's deep learning problems: semantic segmentation and generative vision models. The end product is a semantic segmentation and SPADE pipeline such that both topics could be explored at an introductory level. The high level understanding is that the segmentation model takes an image as an input and outputs a segmentation map; this segmentation map is then fed into a conditional generative adversarial network, specifically SPADE.</p>
      <h2 class="u-text u-text-default u-text-4">Cityscapes</h2>
      <p class="u-text u-text-5">Since both problems I am trying to solve involve deep learning models, it is equally important to choose a good data set. I chose to use the finely annotated Cityscapes dataset because it for training a segmentation model.</p>
      <img class="u-image u-image-default u-image-1" src="images/cityscapes.png" alt="" data-image-width="2040" data-image-height="1016">
      <p class="u-large-text u-text u-text-variant u-text-6">Example Cityscapes image overlayed with its annotated segmentations</p>
    </section>
    <section class="u-align-center u-clearfix u-section-3" id="sec-7beb">
      <div class="u-container-style u-expanded-width u-grey-80 u-group u-shape-rectangle u-group-1">
        <div class="u-container-layout u-container-layout-1">
          <h1 class="u-text u-text-default u-text-1">Section 2: Semantic Segmentation</h1>
        </div>
      </div>
      <p class="u-align-center u-text u-text-2"> For this portion of the project, I decided to follow a transfer-learning approach with a pre-trained model rather than training a newly initialized fully convolutional network. I opted to use a ResNet-34 pre-trained on ImageNet. I had performed experiments with ResNet-50 and ResNet-18 but found that performance vs. training speed were best with ResNet-34. The details of the model is that I replace the average pool and fully connected layer of ResNet-34 with a 1x1 kernel convolutional layer followed by a transpose convolutional layer.&nbsp;This model was then trained end-to-end with an Adam optimizer for 25 epochs with a batch size of 32 and a learning rate of 1e-4. </p>
      <div class="u-clearfix u-gutter-0 u-layout-wrap u-layout-wrap-1">
        <div class="u-layout" style="">
          <div class="u-layout-row" style="">
            <div class="u-align-center u-container-style u-layout-cell u-left-cell u-size-29 u-size-xs-60 u-white u-layout-cell-1" src="">
              <div class="u-container-layout u-container-layout-2">
                <h2 class="u-text u-text-default u-text-3">Training History</h2>
                <p class="u-text u-text-4">Pictured on the left is the loss history of the model while training. Since validation loss is normally just slightly higher than training loss, this means our model is not overfitting and is generalizing well.&nbsp;<br>
                  <br>**Note that training error is calculated as a running error while training which is was causes the initial spike**
                </p>
              </div>
            </div>
            <div class="u-align-center u-container-style u-image u-image-contain u-layout-cell u-right-cell u-size-31 u-size-xs-60 u-image-1" src="" data-image-width="390" data-image-height="266">
              <div class="u-container-layout u-valign-middle u-container-layout-3" src=""></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="u-align-center u-clearfix u-section-4" id="sec-0f4f">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h2 class="u-text u-text-default u-text-1">Results</h2>
        <p class="u-text u-text-2">Pictured below are some example results of my model on training and validation splits.​ In both figures, the top row of images are example training images. The middle row is the training images' true segmentation. The third row is the output maps of my segmentation model.</p>
        <div class="u-expanded-width u-list u-list-1">
          <div class="u-repeater u-repeater-1">
            <div class="u-container-style u-list-item u-repeater-item">
              <div class="u-container-layout u-similar-container u-container-layout-1">
                <img alt="" class="u-expanded-width u-image u-image-contain u-image-default u-image-1" data-image-width="1144" data-image-height="566" src="images/train_images.png">
                <p class="u-large-text u-text u-text-default u-text-variant u-text-3">Training Data Examples</p>
              </div>
            </div>
            <div class="u-container-style u-list-item u-repeater-item">
              <div class="u-container-layout u-similar-container u-container-layout-2">
                <img alt="" class="u-expanded-width u-image u-image-contain u-image-default u-image-2" data-image-width="1144" data-image-height="566" src="images/train_images.png">
                <p class="u-large-text u-text u-text-default u-text-variant u-text-4">Validation Data Examples</p>
              </div>
            </div>
          </div>
        </div>
        <p class="u-text u-text-5"> As is evident from the above figure, the model is relatively imprecise with it's pixel-wise-classifications but is able to capture the general structure of each image. There are a few examples where misclassifications appear to happen such as in the final column of the validation data example. However, this is likely because Cityscapes contains specific classes for car, caravan, truck, and trailer, all of which are fairly similar objects that my model appears to just classify as car. A similar misclassification also appears to happen with person and rider. Likely, these specific classifications would be improved with more training or a larger model.</p>
      </div>
    </section>
    <section class="u-align-center u-clearfix u-section-5" id="sec-b92f">
      <div class="u-container-style u-expanded-width u-grey-80 u-group u-shape-rectangle u-group-1">
        <div class="u-container-layout u-container-layout-1">
          <h1 class="u-text u-text-default u-text-1">Section 3: SPADE</h1>
        </div>
      </div>
      <p class="u-align-center u-text u-text-2"> For this portion of the project, I decided to simply use a pre-trained SPADE generator without any alterations.&nbsp;I first tested the pre-trained SPADE model on true labels to visualize how well the pre-trained model performs. I passed in the label id maps of every validation image as the input to the SPADE model and then visualized each generated image pair. Unfortunately,&nbsp;​the results of the pre-trained SPADE model are not quite as good as I had hoped. The direct input of true labels produced photos that made sense but fell short of realistic. Pictured below are results of the SPADE Generator.</p>
      <img class="u-image u-image-default u-image-1" src="images/ScreenShot2021-12-13at8.27.55PM1.png" alt="" data-image-width="2236" data-image-height="806">
      <p class="u-align-center u-large-text u-text u-text-variant u-text-3">Results of the SPADE generator conditioned on segmentation maps. The top row images are the inputs to the GAN and the second row images are the corresponding ouputs.</p>
    </section>
    <section class="u-align-center u-clearfix u-section-6" id="sec-2750">
      <div class="u-container-style u-expanded-width u-grey-80 u-group u-shape-rectangle u-group-1">
        <div class="u-container-layout u-container-layout-1">
          <h1 class="u-text u-text-default u-text-1">Section 4: The Pipeline</h1>
        </div>
      </div>
      <p class="u-align-center u-text u-text-2">With a working segmentation model and a working SPADE generator, I could now pipeline the two together.&nbsp; The pipeline was a simple as feeding the output segmentations into the generator. Displayed below are some example results of the final generator ouputs.</p>
      <img class="u-image u-image-default u-image-1" src="images/ScreenShot2021-12-13at8.31.07PM1.png" alt="" data-image-width="1968" data-image-height="736">
      <p class="u-align-center u-large-text u-text u-text-variant u-text-3">Results of the SPADE generator from my model's prediction maps. The top row was my model's prediction maps and the second row is the synthesized images.</p>
      <p class="u-align-center u-text u-text-4">Given that neither the SPADE generator or my segmentation maps were that precise, the output images are about as good as expected. All the generated images show promise in terms of color, object differentiation, and general image structure. Nevertheless, It is impressive that given an imprecisise segmentation map, the generator was still able to generate a somewhat realistic image.</p>
    </section>
    <section class="u-align-center u-clearfix u-section-7" id="sec-acc5">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h2 class="u-text u-text-1">Feedback</h2>
        <p class="u-text u-text-2"> One interesting idea I had was what would happen if the generated image was passed back into the segmentation model. In theory, the generated image should not add significantly more structure in the images meaning that the generated image should produce roughly the same segmentation map. As a result, I decided to not only pipeline the segmentation map into SPADE, but pipelined the output of SPADE back into the segmentation model. </p>
        <img class="u-image u-image-default u-image-1" src="images/feedback.png" alt="" data-image-width="1153" data-image-height="598">
        <p class="u-align-center u-large-text u-text u-text-variant u-text-3"> Four examples of feeding generated image into segmentation model. First row is original segmentation maps. Second row is the generated image from the map, third row is the new segmentation map</p>
        <p class="u-align-center u-text u-text-4"> The results of this experiment are roughly what I expected. The new segmentation map is almost the exact same segmentation map as the original but with softer edges. This is actually a testament to the capabilities of the SPADE generator. It is able to generate objects with enough accuracy that not only is its discriminator fooled, but other models such as my segmentation model also see the correct object.</p>
      </div>
    </section>
    <section class="u-align-center u-clearfix u-section-8" id="sec-8ecb">
      <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <h2 class="u-text u-text-1">Concluding Thoughts:</h2>
        <p class="u-text u-text-2"> In regards to the project, I managed to get all my ideas and models functioning but I personally wish my results were a bit more interesting. For the semantic segmentation model, I would have liked to train for longer to get more accurate maps or worked with more complex models such as U-net. For the generator, I think had a idealized idea of what a pre-trained SPADE generator would do. If I had more time and could train my own GAN, I would likely spend some time researching how to add more specificity to the GAN such as generating an image in a specific city or at a specific time-of-day instead of just generating a general Cityscapes image.<br>
          <br>Overall, I learned a lot throughout this project due to the open-ended style of the project. I gained experience in how to decide which data sets and models to use as well as how to extract valuable information from the many different existing git repositories. Especially with working with the SPADE generator, I had spent a lot of time reading through the code and readme files to understand how to actually use a pre-trained model. Additionally, I feel that I have learned better practices in my code when it comes to deep learning and working with a corpus of images. For example, I spent a lot of time just figuring out how to optimize image loading and saving in Colab.&nbsp;
        </p>
      </div>
    </section>


    <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-3925"><div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">CS 194-26: Computational Photography and Computer Vision<br>Norman Karr | nkarr11@berkeley.edu | UC Berkeley
        </p>
      </div></footer>
  </body>
</html>
